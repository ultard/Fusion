# Магазин товаров

## Описание

Этот проект представляет собой микросервисное приложение для управления магазином товаров. Система поддерживает
создание, редактирование, удаление и поиск товаров, обработку заказов и уведомлений. Проект реализован с использованием
Fiber, GORM, RabbitMQ и PostgreSQL, а для развертывания используются Docker и Kubernetes.

## Технологии

- **Fiber** — веб-фреймворк для создания высокопроизводительных и минималистичных HTTP-серверов.
- **GORM** — ORM для работы с базой данных PostgreSQL.
[//]: # (- **RabbitMQ** — брокер сообщений для организации очередей, используется для обработки и доставки событий.)
- **PostgreSQL** — реляционная база данных для хранения данных о товарах, заказах и клиентах.
- **Docker** — контейнеризация приложения для упрощенного развертывания и масштабирования.
- **Kubernetes** — оркестрация контейнеров для управления микросервисами и поддержания отказоустойчивости.

## Основные возможности

- Управление товарами (создание, редактирование, удаление, поиск).
- Обработка заказов и управление корзиной.
- Отправка уведомлений через RabbitMQ.
- Масштабируемость и отказоустойчивость благодаря Kubernetes.

## Структура проекта

```plaintext
├── app
│   ├── cmd
│   │   └── server               # Конфигурация и запуск HTTP-сервера
│   │       └── main.go           # Точка входа приложения
│   ├── database            # Подключение к базе данных
│   │   └── models            # Модели GORM для базы данных
│   ├── middleware        # Промежуточное ПО для обработки запросов
│   ├── handlers          # Определение маршрутов для API
│   ├── schemas           # Схемы для валидации данных 
│   ├── templates         # Шаблоны для генерации почты
│   └── utils             # Вспомогательные функции и утилиты
├── docs                  # Документация API
├── k8s                   # Манифесты Kubernetes для деплоя
├── Dockerfile            # Dockerfile для создания образа приложения
├── docker-compose.yml    # Docker Compose для локального развертывания
├── .env.example          # Пример файла с переменными окружения
└── README.md             # Документация
```

## Запуск проекта

### 1. Предварительные требования

- Docker
- Docker Compose
- Kubernetes (minikube или другая платформа)
- PostgreSQL (настраиваются через Docker Compose)

### 2. Установка и запуск в локальной среде

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/ultar/fusion.git
   cd fusion
   ```

2. Скопируйте `.env.example` и настройте переменные окружения в файле `.env`:

3. Соберите Docker-образы и запустите контейнеры:
   ```bash
   docker-compose up --build
   ```

4. Приложение будет доступно по адресу `http://localhost:8080`.

### 3. Развертывание в Kubernetes

1. Настройте Kubernetes-кластер, если он еще не настроен (например, используя `minikube`):
   ```bash
   minikube start
   ```

2. Примените манифесты Kubernetes из директории `k8s/`:
   ```bash
   kubectl apply -f k8s/
   ```

3. Убедитесь, что все поды запущены:
   ```bash
   kubectl get pods
   ```

4. Получите доступ к приложению, используя NodePort или LoadBalancer.

## API-эндпойнты

### Клиенты
- **GET /users/{id}** — Получить информацию о пользователе по ID
- **GET /users/me** — Получить информацию о текущем пользователе
- **PATCH /users/me** — Обновить информацию о текущем пользователе
- **DELETE /users/me** — Удалить текущего пользователя

### Аутентификация
- **POST /auth/register** — Регистрация нового пользователя
- **POST /auth/login** — Вход пользователя в систему
- **POST /auth/logout** — Выход пользователя из системы
- **POST /auth/refresh** — Обновление токена доступа
- **POST /auth/reset-password** — Запрос на сброс пароля
- **POST /auth/change-password** — Смена пароля
- **POST /auth/verify-email** — Подтверждение email

### Товары

- **GET /products** — Получить список всех товаров
- **GET /products/{id}** — Получить товар по ID
- **POST /products** — Создать новый товар
- **PUT /products/{id}** — Обновить товар по ID
- **DELETE /products/{id}** — Удалить товар по ID

- **POST /products/{id}/reviews** — Создать отзыв к товару
- **DELETE /products/{id}/reviews** — Удалить отзыв к товару

- **POST /products/{id}/favourites** — Добавить товар в избранное
- **DELETE /products/{id}/favourites** — Удалить товар из избранного

### Корзина
- **GET /cart** — Получить содержимое корзины
- **POST /cart** — Добавить товар в корзину
- **PUT /cart** — Обновить товар в корзине
- **DELETE /cart** — Очистить корзину

### Заказы

- **GET /orders** — Получить список всех заказов
- **POST /orders** — Создать новый заказ
- **PUT /orders/{id}** — Обновить заказ по ID
- **DELETE /orders/{id}** — Удалить заказ по ID

### Пример запроса

**Создание товара**

```http
POST /products
Content-Type: application/json

{
  "name": "Example Product",
  "description": "This is a product example.",
  "price": 100,
  "stock": 50
}
```

## Тестирование

Для тестирования используйте `curl`, Postman или другой HTTP-клиент. Рекомендуется тестировать основные эндпойнты для
проверки корректности работы приложения.

## Лицензия

Этот проект лицензирован под лицензией MIT. Подробности смотрите в файле LICENSE.